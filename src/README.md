# risky2
## パイプライン動作機構
ポジティブエッジでそのステージの動作をし、ネガティブエッジで次のステージに送る。ステージ間のパイプラインレジスタはネガティブエッジでセットされそれを使う側からはワイヤで繋がっているように見える。

## データハザード、バイパスネットワーク
そもそもインオーダ実行なので、出力依存・逆依存は発生しない。つまり対処すべきは真の依存のみである。

Wステージの立ち上がりでレジスタファイルに書き込まれるので、ハザードを起こしうるのはE,Mステージの命令で、以下の条件のとき。

* それぞれのrdがrs1,rs2と同じ
* rdのwEnableがtrue
* rs1,rs2のタイプがREG

また、バイパスは以上の条件かつE,Mの命令がバイパス可能ならバイパスできる。

## 制御ハザード、分岐予測
分岐系命令の分岐先アドレスが確定するのはEの立ち下がりなので、そのタイミングで分岐のヒット、ミス判定を行う。ミスならその時点でのF,Dをフラッシュ。
ミス時のペナルティと制御ハザードによるストールが同じなので、常に分岐しない分岐予測が最速。さらなる性能向上には分岐先予測が必要。
